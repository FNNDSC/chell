= ChELL Architecture

ChELL (ChRIS Execution Logic Layer) is an interactive shell for the ChRIS Research Integration System. It provides a familiar POSIX-like environment that abstracts the complex graph topology of ChRIS into a navigable filesystem.

== Core Concepts

=== 1. Unified File System (UFS)
The user interacts with a single file tree. ChELL is responsible for routing paths to the correct provider.

*   **Native ChRIS FS:** Paths that exist on the CUBE server (e.g., `/home/user/feeds/...`). These are accessed via the ChRIS API.
*   **Virtual File System (VFS):** Supplemental paths that do not exist on the server but provide utility or abstraction (e.g., `/bin` for plugins).

=== 2. The Router (`src/lib/vfs/vfs.ts`)
The Router intercepts all filesystem operations (`ls`, `cd`, `pwd`).
*   It checks the path against a configuration of **Virtual Mount Points**.
*   If a path matches a mount (e.g., `/bin`), it delegates to the **Virtual Provider**.
*   If a path does not match, it delegates to the **Chris Provider** (Native FS).

=== 3. Execution Model ("The Sandwich")
ChELL is a consumer of the **ChILI Library**. It strictly adheres to the "Sandwich Model" architecture:

*   **Presentation (Shell):** `chell` handles the REPL loop, history, and tab completion.
*   **Controllers (ChILI):** `chell` imports command logic directly from `@fnndsc/chili`. It does not spawn external processes for core commands. This ensures shared state and high performance.
*   **Logic (Salsa):** Pure business logic and resource models.
*   **Infrastructure (Cumin):** State and API connectivity.

== Directory Structure

[source]
----
src/
├── config/           # App configuration and prompt styling
├── core/             # Shell loop mechanics (REPL, Parser)
├── lib/
│   ├── vfs/          # File system abstraction (Router)
│   └── completer/    # Tab completion engine
├── builtins/         # Command wrappers (calling Chili library functions)
├── session/          # Runtime state (Connection, Environment)
└── index.ts          # Entry point
----

== Components

=== Session (`src/session/`)
Holds the persistent state:
*   `chrisConnection`: The authenticated client (from `@fnndsc/cumin`).
*   `currentContext`: The current working directory (`CWD`).

=== Builtins (`src/builtins/`)
Each built-in command (`ls`, `connect`, `plugin`, `feed`) is a wrapper that:
1.  Parses arguments.
2.  Invokes the corresponding **ChILI Command** (e.g., `plugins_fetchList`).
3.  Invokes the corresponding **ChILI View** (e.g., `renderPluginList`) to display the result.

This architecture ensures that `chell` acts as a unified interface to the underlying ChRIS ecosystem libraries.